# 公网与内网访问科普

> 一文搞懂公网、内网、内网穿透，以及如何在手机上访问家里的服务器

---

## 📍 什么是内网？

**内网（局域网 / LAN）** = 你家/公司/学校内部的小网络

### 特点
- **IP 地址**：`192.168.x.x`、`10.x.x.x`、`172.16.x.x`
- **范围**：只有连上同一个WiFi/网线才能访问
- **速度**：快，不占用外网带宽
- **安全**：相对安全，外部无法直接访问

### 例子
```
手机 ───WiFi──→ 路由器 ───→ 电脑
                        └──→ 打印机
                        └──→ NAS
                        └──→ WSL2
```
所有设备都在同一个"小圈子"里，互相认识（能ping通），但外面的人进不来。

---

## 🌍 什么是公网？

**公网（互联网 / WAN）** = 全世界连在一起的超级网络

### 特点
- **IP 地址**：全球唯一（如 `114.114.114.114`）
- **范围**：任何地方都能访问（只要有网）
- **速度**：取决于带宽和网络质量
- **安全**：暴露在外，需要防护措施

### 例子
```
北京的你 ───互联网──→ 美国的 Google 服务器
```

---

## 🔒 内网 vs 公网 对比

| 对比项 | 内网（局域网） | 公网（互联网） |
|--------|---------------|---------------|
| **IP 范围** | 192.168.x.x, 10.x.x.x 等 | 全球唯一的公网IP |
| **访问范围** | 同一个WiFi/网络内 | 全世界任何有网的地方 |
| **速度** | 快（千兆局域网） | 取决于带宽 |
| **安全性** | 高（外部无法直接访问） | 低（需要防火墙保护） |
| **成本** | 免费 | 需要公网IP或穿透服务 |
| **典型应用** | 文件共享、打印机、智能家居 | 网站、云服务器、远程办公 |

---

## 🚪 内网穿透是什么？

**问题**：你在家里的 WSL2 上搭了个服务，怎么让公司/学校/外地的手机访问？

**答案**：内网穿透（NAT穿透）

### 原理
内网设备主动连接一个"中介服务器"，建立隧道，让外部流量通过隧道到达内网设备。

```
手机（任何地方） ───→ 中介服务器（有公网IP）
                          ↑
                          └── 隧道 ───→ 家里的电脑（内网）
```

---

## 🛠️ 常见的内网穿透方案

### 1. Tailscale（推荐）⭐
**原理**：P2P虚拟组网，设备间直接通信

**优点**：
- ✅ 免费、开源
- ✅ 安装简单（一条命令）
- ✅ 加密安全（WireGuard协议）
- ✅ 不需要公网IP
- ✅ 支持所有平台（Windows、macOS、Linux、iOS、Android）

**缺点**：
- 依赖Tailscale的服务器做初始握手（可自建）

**适用场景**：个人远程访问家里服务器、异地组网

**安装**（WSL2）：
```bash
curl -fsSL https://tailscale.com/install.sh | sh
sudo tailscale up
```

---

### 2. ZeroTier
**原理**：类似Tailscale，虚拟局域网

**优点**：
- ✅ 免费版支持25个设备
- ✅ 支持自建控制器
- ✅ 跨平台

**缺点**：
- 配置比Tailscale复杂一点

---

### 3. frp（Fast Reverse Proxy）
**原理**：反向代理，需要一台有公网IP的服务器做中转

**架构**：
```
手机 ───→ 公网服务器（frps）
             ↑
             └── frpc ───→ 内网服务
```

**优点**：
- ✅ 开源免费
- ✅ 功能强大（TCP/UDP/HTTP/HTTPS）
- ✅ 支持加密、压缩、负载均衡

**缺点**：
- 需要一台有公网IP的服务器（可以租最便宜的VPS）

**适用场景**：有公网服务器，需要稳定穿透

---

### 4. ngrok
**原理**：商业化的内网穿透服务

**优点**：
- ✅ 注册即用，无需配置服务器
- ✅ 支持HTTPS、自定义域名（付费）
- ✅ Web界面查看请求

**缺点**：
- ❌ 免费版限制多（随机域名、连接数限制）
- ❌ 付费较贵

**适用场景**：临时演示、开发调试

---

### 5. Cloudflare Tunnel（cloudflared）
**原理**：Cloudflare的边缘网络代理

**优点**：
- ✅ 免费
- ✅ 利用Cloudflare的全球CDN
- ✅ 支持HTTPS自动证书
- ✅ 无需公网IP

**缺点**：
- 依赖Cloudflare服务
- 需要域名（可以是免费的二级域名）

**适用场景**：网站、Web服务

---

## 📱 手机上访问内网服务

### 方案对比

| 方案 | 需要公网IP | 需要服务器 | 安全性 | 推荐度 |
|------|-----------|-----------|--------|--------|
| Tailscale | ❌ | ❌ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| ZeroTier | ❌ | ❌ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| frp | ❌ | ✅（中转） | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| ngrok | ❌ | ❌（用他们） | ⭐⭐⭐ | ⭐⭐⭐ |
| 公网IP直连 | ✅ | ❌ | ⭐⭐（需配置） | ⭐⭐ |

---

## 🏠 实战：手机访问 WSL2 的 SSH

### 方案：Tailscale

**第1步：WSL2 安装 Tailscale**
```bash
curl -fsSL https://tailscale.com/install.sh | sh
sudo tailscale up
```

**第2步：确保 SSH 服务运行**
```bash
sudo apt install openssh-server
sudo service ssh start
```

**第3步：手机安装 Tailscale App**
- iOS：App Store 搜索 Tailscale
- Android：Google Play 或官网下载

**第4步：登录同一账号**
手机上登录和 WSL2 相同的 Tailscale 账号

**第5步：连接**
```
手机 SSH 客户端 ───→ WSL2的TailscaleIP:22
```

**完成！** 你现在在任何地方都能 SSH 到家里的 WSL2 了！

---

## ⚠️ 安全提醒

1. **不要用弱密码**：如果暴露在公网，一定要用密钥认证而非密码
2. **及时更新**：保持系统和软件最新
3. **最小权限**：只开放必要的端口
4. **日志监控**：定期检查访问日志
5. **优先用 Tailscale/Cloudflare**：比直接暴露公网IP安全得多

---

## 📝 总结

| 你想做什么 | 推荐方案 |
|-----------|---------|
| 手机访问家里服务器 | Tailscale / ZeroTier |
| 临时给外人演示网站 | ngrok |
| 长期稳定生产环境 | frp + 自有服务器 |
| 网站/博客 | Cloudflare Tunnel |
| 公司有IT支持 | VPN（WireGuard/OpenVPN） |

内网穿透的世界很广，但对个人用户来说，**Tailscale 是最简单、安全、免费的选择**。

---

*文档作者：蛋黄 🐱*

*文档生成时间：2026-02-06 02:47:00 (Asia/Shanghai)*
